(this["webpackJsonpreact-oauth2-authcode-provider-example"]=this["webpackJsonpreact-oauth2-authcode-provider-example"]||[]).push([[0],{142:function(e,t,o){e.exports=o(289)},143:function(e,t,o){},173:function(e,t){},175:function(e,t){},186:function(e,t){},188:function(e,t){},215:function(e,t){},217:function(e,t){},218:function(e,t){},224:function(e,t){},226:function(e,t){},244:function(e,t){},246:function(e,t){},258:function(e,t){},261:function(e,t){},267:function(e,t,o){},289:function(e,t,o){"use strict";o.r(t);o(143);var n=o(0),a=o.n(n),r=o(136),i=o.n(r),s=o(22),l=o(28),c=o(3),u=o(64),h=o(137),d=o(42),p=o(141),g=o(140),m=o(4),f=o.n(m),v=o(68),b=o(65),k=o.n(b),E=new v.a,_=o(169);function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!1,o=localStorage.getItem(e+"access_token_expiry");if(o){var n=new Date,a=new Date(o);n>=a&&(t=!0)}return t}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!x(e)}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E.get(e+"access_token")}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!S(e)}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E.get(e+"refresh_token")}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(E.remove(o+"access_token"),E.remove(o+"refresh_token"),localStorage.removeItem(o+"id_token"),!n||!localStorage.getItem(o+"authcode_authentication_redirect")){var a=t;null==a&&(a=window.location.pathname+window.location.search),localStorage.setItem(o+"authcode_authentication_redirect",a)}var r=N(e);window.location.replace(r)}function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=e.authUrl,n=e.callBackPath,a=e.clientId,r=e.scope,i=e.usePkce,s=e.useState,l=e.useNonce,c=o;if(c+="?client_id="+a,c+="&response_type=code",r&&(c+="&scope="+encodeURIComponent(r)),c+="&redirect_uri="+encodeURIComponent(A(n)),i){var u=C(_.randomBytes(32)),h=C(O(u));localStorage.setItem(t+"authcode_v",u),c+="&code_challenge="+h,c+="&code_challenge_method=S256"}else localStorage.removeItem(t+"authcode_v");if(s){var d=C(_.randomBytes(32));localStorage.setItem(t+"authcode_state",d),c+="&state="+d}else localStorage.removeItem(t+"authcode_state");if(l){var p=C(_.randomBytes(32));localStorage.setItem(t+"authcode_nonce",p),c+="&nonce="+p}else localStorage.removeItem(t+"authcode_nonce");return c}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";E.remove(t+"access_token"),E.remove(t+"refresh_token"),localStorage.removeItem(t+"id_token");var o=encodeURIComponent(A(null==e.logoutCallBackPath?"":e.logoutCallBackPath));window.location.replace(e.logoutUrl+"?post_logout_redirect_uri="+o+"&returnTo="+o+"&client_id="+e.clientId)}function A(e){var t=e;return t||(t=""),t.toUpperCase().includes("HTTP://")||t.toUpperCase().includes("HTTPS://")?t:location.protocol+"//"+location.host+t}function C(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function O(e){return _.createHash("sha256").update(e).digest()}function R(e,t){e=e.replace(/[[\]]/g,"\\$&");var o=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function L(e){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}var q={__proto__:null,isLoggedIn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!w(e)||!(!T(e)||y(e))},hasTokenExpired:y,hasAccessToken:T,accessToken:x,hasRefreshToken:w,refreshToken:S,signRequest:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e||(e={});var o=x(t);return o&&(e.Authorization="Bearer "+o),e},doAuthorizationCodeFlow:P,doLogoutFlow:I,buildRedirectUri:A,base64URLEncode:C,sha256:O,getURIParameterByName:R,parseJwt:L},j="_styles-module__loader-box__1hjhJ",U="_styles-module__pulse-container__eafjx",B="_styles-module__pulse-bubble__3Wu7F",F="_styles-module__pulse-bubble-1__1OrBQ",D="_styles-module__pulse-bubble-2__2SSXc",z="_styles-module__pulse-bubble-3__21K97",J="_styles-module__loader-text__1WOdI",M=function(e){return a.a.createElement("div",{className:j,style:e.styles},a.a.createElement("div",{className:U},a.a.createElement("div",{className:B+" "+F}),a.a.createElement("div",{className:B+" "+D}),a.a.createElement("div",{className:B+" "+z})),e.text?a.a.createElement("div",{className:J},e.text):null)},G=function(e){return a.a.createElement("div",{className:j,style:e.styles},e.text?a.a.createElement("div",{className:J},e.text,e.onBtnClick?a.a.createElement("div",null,a.a.createElement("button",{className:"btn btn-primary",style:{marginTop:"15px"},onClick:e.onBtnClick},e.btnText)):null):null)},Y=new v.a,W=o(264),H={loading:!0,signinError:!1},Q=function(e){Object(p.a)(o,e);var t=Object(g.a)(o);function o(e){var n;return Object(u.a)(this,o),(n=t.call(this,e)).state=H,n.retryAuth=n.retryAuth.bind(Object(d.a)(n)),n}return Object(h.a)(o,[{key:"componentDidMount",value:function(){this.props.doLogout?this.doLogout():this.processAuth(!1)}},{key:"componentDidUpdate",value:function(e){this.props.doLogout&&!e.doLogout?this.doLogout():this.props.authenticationRequired&&!e.authenticationRequired&&this.processAuth(!1)}},{key:"componentWillUnmount",value:function(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)}},{key:"processAuth",value:function(e){this.debugit("Authentication Required");var t=!1,o=localStorage.getItem(this.props.storagePrefix+"access_token_expiry");if(o){var n=new Date,a=new Date(o);if(n>=a)t=!0;else{var r=a.valueOf()-n.valueOf();this.setTokenRefresh(r)}}if(T(this.props.storagePrefix)&&!t)this.debugit("Access token present and valid. Expiry = "+o),this.state.loading&&this.setState({loading:!1});else if(w(this.props.storagePrefix))this.debugit("Refresh token present. Feteching new access token"),this.doRefreshFlow(e);else if(e)this.sessionExpired();else{var i=R("code",window.location.href);i?(this.debugit("Authentication code detected. Fetching token"),null!=this.props.onReceiveAuthCode&&this.props.onReceiveAuthCode(i),this.tradeCodeForToken(i)):this.props.authenticationRequired?(this.debugit("Redirecting to authoisation endpoint"),this.getAuthCode()):this.setState({loading:!1})}}},{key:"doLogout",value:function(){I(this.props.authenticationProps,this.props.storagePrefix)}},{key:"getAuthCode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null!=this.props.onGetAuthCode&&this.props.onGetAuthCode(),this.setState({loading:!0}),P(this.props.authenticationProps,this.props.returnTo,this.props.storagePrefix,e)}},{key:"tradeCodeForToken",value:function(e){var t=this,o=this.props.authenticationProps,n=o.tokenUrl,a=o.callBackPath,r=o.clientId,i=o.clientSecret,s=o.scope,l=o.usePkce,c=o.useState;if(this.debugit("Code url: "+window.location.href),c){var u=R("state",window.location.href),h=localStorage.getItem(this.props.storagePrefix+"authcode_state");if(u!==h){var d="State does not match";this.debugit(d),console.log(d),null!=this.props.onTokenObtainedError&&this.props.onTokenObtainedError(new Error(d)),this.setState({signinError:!0})}else this.debugit("State matches "+h);localStorage.removeItem(this.props.storagePrefix+"authcode_state")}var p={grant_type:"authorization_code",client_id:r,redirect_uri:A(a),scope:s,code:e};if(i&&(p.client_secret=i),s&&(p.scope=s),l){var g=localStorage.getItem(this.props.storagePrefix+"authcode_v");g&&(p.code_verifier=g)}k.a.post(n,W.stringify(p),{headers:{"content-type":"application/x-www-form-urlencoded"}}).then((function(e){if(t.debugit("Access token response"),t.debugit(e),!e.data||!e.data.access_token)throw new Error("Access token not present in token response");if(e.data.error)throw new Error(e.data.error_description);t.setTokens(e.data,!1),null!=t.props.onTokenObtained&&t.props.onTokenObtained(e.data)})).catch((function(e){console.log(e),t.debugit("Access token error"),t.debugit(null===e||void 0===e?void 0:e.response),null!=t.props.onTokenObtainedError&&t.props.onTokenObtainedError(e),t.setState({signinError:!0})}))}},{key:"doRefreshFlow",value:function(e){var t=this,o=this.props.authenticationProps,n=o.tokenUrl,a=o.callBackPath,r=o.clientId,i=o.clientSecret,s=o.scope,l={grant_type:"refresh_token",client_id:r,redirect_uri:A(a),scope:s,refresh_token:S(this.props.storagePrefix)};i&&(l.client_secret=i),s&&(l.scope=s),k.a.post(n,W.stringify(l),{headers:{"content-type":"application/x-www-form-urlencoded"}}).then((function(o){if(t.debugit("Refresh token response"),t.debugit(o),!o.data||!o.data.access_token)throw new Error("Access token not present in token response");if(o.data.error)throw new Error(o.data.error_description);t.setTokens(o.data,!0),e?null!=t.props.onTokenRefreshed&&t.props.onTokenRefreshed(o.data):null!=t.props.onTokenObtained&&t.props.onTokenObtained(o.data)})).catch((function(o){console.log(o),t.debugit("Refresh token error"),t.debugit(null===o||void 0===o?void 0:o.response),e?null!=t.props.onTokenRefreshedError&&t.props.onTokenRefreshedError(o):(t.props.authenticationRequired?t.setState({signinError:!0}):(t.setState({loading:!1}),Y.remove(t.props.storagePrefix+"refresh_token"),localStorage.removeItem(t.props.storagePrefix+"id_token")),null!=t.props.onTokenObtainedError&&t.props.onTokenObtainedError(o))}))}},{key:"sessionExpired",value:function(){window.confirm(this.props.refreshErrorText)?this.retryAuth():setTimeout(this.processAuth.bind(this,!0),6e4)}},{key:"setTokens",value:function(e,t){var o=e.id_token;if(o){var n=localStorage.getItem(this.props.storagePrefix+"authcode_nonce");if(this.props.authenticationProps.useNonce&&n){var a=JSON.parse(L(o));if(a){if(a.nonce!==n)throw console.log(a),this.debugit("Expected nonce "+n),this.debugit("Actual nonce "+a.nonce),new Error("Nonce does not match");this.debugit("Nonce matches "+n)}}n&&localStorage.removeItem(this.props.storagePrefix+"authcode_nonce"),localStorage.setItem(this.props.storagePrefix+"id_token",o)}var r=60;e.expires_in&&(r=e.expires_in/60),(r-=2)<1&&(r=1),this.debugit("Token expiry mins: "+r);var i=new Date,s=new Date(i.getTime()+6e4*r);localStorage.setItem(this.props.storagePrefix+"access_token_expiry",s.toString()),Y.set(this.props.storagePrefix+"access_token",e.access_token,{path:"/"}),this.debugit("New Access Token: "+e.access_token);var l=e.refresh_token;if(l||(l=S(this.props.storagePrefix)),l&&(Y.set(this.props.storagePrefix+"refresh_token",l,{path:"/",expires:new Date(i.setMonth(i.getMonth()+4))}),this.debugit("New Refresh Token: "+e.access_token)),this.setTokenRefresh(6e4),!t){localStorage.getItem(this.props.storagePrefix+"authcode_v")&&localStorage.removeItem(this.props.storagePrefix+"authcode_v");var c=localStorage.getItem(this.props.storagePrefix+"authcode_authentication_redirect");c?localStorage.removeItem(this.props.storagePrefix+"authcode_authentication_redirect"):c="",this.props.history?this.props.history.replace({pathname:c.includes("?")?c.substring(0,c.indexOf("?")):c,search:c.includes("?")?c.substring(c.indexOf("?")):""}):window.location.replace(c)}this.state.loading&&this.setState({loading:!1})}},{key:"setTokenRefresh",value:function(e){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null),this.refreshTimer=setTimeout(this.processAuth.bind(this,!0),e)}},{key:"retryAuth",value:function(){Y.remove(this.props.storagePrefix+"access_token"),Y.remove(this.props.storagePrefix+"refresh_token"),localStorage.removeItem(this.props.storagePrefix+"id_token"),this.getAuthCode(!0)}},{key:"debugit",value:function(e){this.props.enableDebugLog&&console.log(e)}},{key:"render",value:function(){if(this.state.signinError)return Object(n.createElement)(this.props.signInErrorComponent?this.props.signInErrorComponent:G,{text:this.props.signInErrorText,btnText:"Retry",onBtnClick:this.retryAuth});if(this.state.loading||this.props.doLogout){var e=this.props.doLogout?this.props.signOutText:this.props.signInText;return Object(n.createElement)(this.props.loaderComponent?this.props.loaderComponent:M,{text:e})}return this.props.children}}]),o}(n.Component);Q.defaultProps={authenticationRequired:!0,doLogout:!1,storagePrefix:"",enableDebugLog:!1,signInText:"Signing you in...",signOutText:"Signing you out...",signInErrorText:"Sorry, we were unable to sign you in. Please try again later.",refreshErrorText:"Your session has expired.\nSign in again to continue."},Q.propTypes={authenticationRequired:f.a.bool,doLogout:f.a.bool,authenticationProps:f.a.object.isRequired,returnTo:f.a.string,history:f.a.any,storagePrefix:f.a.string,onGetAuthCode:f.a.func,onReceiveAuthCode:f.a.func,onTokenObtained:f.a.func,onTokenObtainedError:f.a.func,onTokenRefreshed:f.a.func,onTokenRefreshedError:f.a.func,enableDebugLog:f.a.bool,signInText:f.a.string,signOutText:f.a.string,signInErrorText:f.a.string,refreshErrorText:f.a.string,loaderComponent:f.a.any,signInErrorComponent:f.a.any};o(267);var Z=o(138),$=o.n(Z),K=function(e){var t=Object(n.useState)(!1),o=Object(s.a)(t,2),r=o[0],i=o[1],l=Object(n.useState)(null),c=Object(s.a)(l,2),u=c[0],h=c[1],d=q.isLoggedIn();return a.a.createElement("div",null,a.a.createElement("div",{className:"mt-3 mb-3"},a.a.createElement("button",{className:"btn btn-primary mr-3",onClick:function(){return q.doAuthorizationCodeFlow(e.authProps)}},"Start Authorization Code Flow"),a.a.createElement("button",{className:"btn btn-primary mr-3",onClick:function(){return q.doLogoutFlow(e.authProps)}},"Start Log out Flow")),a.a.createElement("div",{className:"mt-3 mb-3"},a.a.createElement("button",{className:"btn btn-primary mr-3",disabled:!d,onClick:function(){i(!0),$.a.post("https://dev-emf33n24.eu.auth0.com/userinfo",null,{headers:q.signRequest({"content-type":"application/json"})}).then((function(e){i(!1),h(e)})).catch((function(e){console.log(e),i(!1),h(e)}))}},"Get User Info"),r?"Loading...":"",u&&!r?a.a.createElement("div",{className:"mt-2"},(null===u||void 0===u?void 0:u.data)?JSON.stringify(null===u||void 0===u?void 0:u.data):"Error"):""))},V=Object(c.f)((function(e){var t=Object(n.useState)(!1),o=Object(s.a)(t,2),r=o[0],i=o[1],u=Object(n.useState)(!1),h=Object(s.a)(u,2),d=h[0],p=h[1],g=Object(n.useState)(null),m=Object(s.a)(g,2)[1],f={authUrl:"https://dev-emf33n24.eu.auth0.com/authorize",callBackPath:"/react-oauth2-authcode-provider/",tokenUrl:"https://dev-emf33n24.eu.auth0.com/oauth/token",logoutUrl:"https://dev-emf33n24.eu.auth0.com/v2/logout",logoutCallBackPath:"/react-oauth2-authcode-provider/",clientId:"0ujnTs1Uynm6W83ygzbkuRkMhqdTrZ26",clientSecret:"DhYAsb9z9LxMDsZL3shPFaB90sCSqMptPaMU-EnB7fEUv-ECbMjqlvn6nQTOVoLG",scope:"openid profile email phone address offline_access",usePkce:!0,useState:!0,useNonce:!0},v=q.isLoggedIn(),b="",k=localStorage.getItem("id_token");if(k)try{var E=JSON.parse(q.parseJwt(k));E&&(b=E.name)}catch(T){}var _=a.a.createElement("div",null,"You ",a.a.createElement("b",null,v?"are":"are not")," logged in",a.a.createElement("b",null,v&&b?" as "+b:""),"."),y=a.a.createElement("div",{className:"mt-4 mb-5"},a.a.createElement("hr",{className:"mb-4"}),a.a.createElement("p",null,"These examples use a example Auth0 authorization server."),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-lg-4"},a.a.createElement("div",{className:"card h-100 m-1"},a.a.createElement("div",{className:"card-body"},a.a.createElement("p",null,"The ",a.a.createElement("b",null,"No Auth page")," does not require you to be logged in to access. You can initiate the OAuth2 Authorization code flow by selecting the login button though."),a.a.createElement("p",null,"It uses the AuthCodeProvider component with authenticationRequired = the state of whether the log in button has been pressed.")))),a.a.createElement("div",{className:"col-lg-4"},a.a.createElement("div",{className:"card h-100 m-1"},a.a.createElement("div",{className:"card-body"},a.a.createElement("p",null,"The ",a.a.createElement("b",null,"Auth Required page")," requires you to be logged in to access. Browsing too this page will initiate the OAuth2 Authorization code flow if you are not already logged in."),a.a.createElement("p",null,"It uses the AuthCodeProvider component with authenticationRequired = true."),a.a.createElement("p",null,"You can also use this implementation to require authentication for the whole application. To require authentication for the whole application, render a single instance of AuthCodeProvider in a top level component (E.g App).")))),a.a.createElement("div",{className:"col-lg-4"},a.a.createElement("div",{className:"card h-100 m-1"},a.a.createElement("div",{className:"card-body"},a.a.createElement("p",null,"The ",a.a.createElement("b",null,"Functions page")," has alternate methods to begin the Authorization code or Logout flows. These methods use Functions to initiate the flow instead of parsing props to AuthCodeProvider. This is useful for starting the flows in deep nested components instead of passing variables up the stack."))))));return a.a.createElement("div",null,a.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-dark bg-secondary fixed-top"},a.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},a.a.createElement("span",{className:"navbar-toggler-icon"})),a.a.createElement("div",{style:{width:"100%"}},a.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},a.a.createElement("ul",{className:"navbar-nav ml-lg-5","data-toggle":"collapse","data-target":".navbar-collapse.show"},a.a.createElement("li",{className:"nav-item mr-lg-3"},a.a.createElement(l.b,{className:"/"===e.location.pathname?"nav-link active":"nav-link",to:"/"},"No Auth")),a.a.createElement("li",{className:"nav-item mr-lg-3"},a.a.createElement(l.b,{className:"/authrequired"===e.location.pathname?"nav-link active":"nav-link",to:"/authrequired"},"Auth Required")),a.a.createElement("li",{className:"nav-item mr-lg-3"},a.a.createElement(l.b,{className:"/functions"===e.location.pathname?"nav-link active":"nav-link",to:"/functions"},"Functions"))),"/functions"===e.location.pathname?"":a.a.createElement("ul",{className:"navbar-nav ml-auto mr-lg-5","data-toggle":"collapse","data-target":".navbar-collapse.show"},v?a.a.createElement("li",{className:"nav-item mr-lg-3"},a.a.createElement("button",{className:"nav-link btn btn-link",onClick:function(){return p(!0)}},"Logout")):a.a.createElement("li",{className:"nav-item mr-lg-3"},a.a.createElement("button",{className:"nav-link btn btn-link",onClick:function(){return i(!0)}},"Login")))))),a.a.createElement("div",{className:"ml-lg-5 ml-3 mr-lg-5 mr-3",style:{marginTop:"100px"}},a.a.createElement("h1",{className:"mb-3"},"react oauth2 authcode provider examples"),a.a.createElement(c.c,null,a.a.createElement(c.a,{exact:!0,path:"/"},a.a.createElement(Q,{authenticationProps:f,history:e.history,authenticationRequired:r,doLogout:d,enableDebugLog:!0,onTokenObtained:function(e){return m(e)},onTokenObtainedError:function(e){m(e)}},a.a.createElement("h3",null,"No Auth"),a.a.createElement("span",{style:{fontStyle:"italic"}},"This page does not require you to be logged in, but you can log in with the login button on the nav bar."),_,y)),a.a.createElement(c.a,{exact:!0,path:"/functions"},a.a.createElement(Q,{authenticationProps:f,history:e.history,authenticationRequired:!1,enableDebugLog:!0,onTokenObtained:function(e){return m(e)},onTokenObtainedError:function(e){m(e)}},a.a.createElement("h3",null,"Functions"),a.a.createElement("span",{style:{fontStyle:"italic"}},"This page has functions to manually initiate the Authorization code flow or logout flow using functions."),_,a.a.createElement(K,{authProps:f}),y)),a.a.createElement(c.a,{exact:!0,path:"*"},a.a.createElement(Q,{authenticationProps:f,history:e.history,authenticationRequired:!0,doLogout:d,enableDebugLog:!0,onTokenObtained:function(e){return m(e)},onTokenObtainedError:function(e){return m(e)}},a.a.createElement(c.c,null,a.a.createElement(c.a,{path:"/authrequired"},a.a.createElement("h3",null,"Auth Required"),a.a.createElement("span",{style:{fontStyle:"italic"}},"This page requires you to be logged in. It's content only shows when you are logged in."),_,y),a.a.createElement(c.a,{path:"/callback"})))))))}));o(288);i.a.render(a.a.createElement(l.a,{basename:"react-oauth2-authcode-provider"},a.a.createElement(V,null)),document.getElementById("root"))}},[[142,1,2]]]);
//# sourceMappingURL=main.46900b92.chunk.js.map